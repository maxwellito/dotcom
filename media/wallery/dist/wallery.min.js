/**
 * wallery - Generate a map from a list of displayable elements
 * @version v1.0.0
 * @link https://github.com/maxwellito/wallery#readme
 * @license MIT
 */
"use strict";!function(t){function i(t,i,e){this.widthPx=t,this.heightPx=i,this.widthUnit=0,this.heightUnit=0,this.size=0,this.usemeter=0,this.attached=e}function e(t){return 0>=t?!1:(this.unit=t,this.size=0,this.isSorted=!0,void(this.portfolio=[]))}function h(t,i,e){if(0>=i&&0>=e&&0>=t)return!1;this.width=i,this.height=e,this.unit=t,this.size=this.width*this.height,this.freeSpace=this.size,this.result=[],this.table=[];var h,o,s;for(o=0;o<this.width;o++){for(h=[],s=0;s<this.height;s++)h.push(!1);this.table.push(h)}}function o(t){if(void 0===t.unit||void 0===t.mapWidth||void 0===t.mapHeight)throw"Wallery: settings aren't defined";if(t.unit<=0)throw"Wallery: unit is not valid";if(t.unit>t.mapWidth||t.unit>t.mapHeight)throw"Wallery: unit is bigger than the map";this.unit=t.unit,this.mapWidthPx=t.mapWidth,this.mapHeightPx=t.mapHeight,this.crop=void 0!==t.crop?t.crop:!0,this.isGenerated=!1,this.marge=0,this.nbRandTentatives=5;var i=Math.ceil(t.mapWidth/this.unit),o=Math.ceil(t.mapHeight/this.unit);this.map=new h(this.unit,i,o),this.album=new e(this.unit)}i.prototype.updateUnit=function(t){return t>this.widthPx||t>this.heightPx?!1:(this.widthUnit=Math.floor(this.widthPx/t),this.heightUnit=Math.floor(this.heightPx/t),this.size=this.widthUnit*this.heightUnit,!0)},i.prototype.resetUsemeter=function(){this.usemeter=0},i.prototype.incUsemeter=function(){this.usemeter+=1},i.prototype.getUsemeter=function(){return this.usemeter},i.prototype.display=function(t){console.log(t+"Class WalleryItem"),console.log(t+"widthPx:    "+this.widthPx),console.log(t+"heightPx:   "+this.heightPx),console.log(t+"widhtUnit:  "+this.widthUnit),console.log(t+"heightUnit: "+this.heightUnit),console.log(t+"size:       "+this.size),console.log(t+"usemeter:   "+this.usemeter),console.log(t+"url:        "+this.url),console.log("---")},e.prototype.addItem=function(t){return t.updateUnit(this.unit)?(this.portfolio.push(t),this.isSorted=!1,this.size+=t.size,!0):!1},e.prototype.resetUsemeter=function(){for(var t in this.portfolio)this.portfolio[t].resetUsemeter()},e.prototype.sortIt=function(){this.portfolio.sort(function(t,i){return i.size-t.size}),this.isSorted=!0},e.prototype.getItemBiggerThan=function(t,i){var e=this.getItemListBiggerThan(t,i);return e===!1?!1:e[Math.ceil(Math.random()*e.length)%e.length]},e.prototype.getItemListBiggerThan=function(t,i){var e,h=[];for(var o in this.portfolio)e=this.portfolio[o],e.widthUnit>=t&&e.heightUnit>=i&&h.push(e);return h},e.prototype.display=function(t){t=void 0===t?"":t,console.log(t+"Class Album"),console.log(t+"unit : "+this.unit),console.log(t+"size : "+this.size);for(var i in this.portfolio)this.portfolio[i].display("    ")},h.prototype.valuesCheck=function(t,i,e,h){return 0>t||0>i||0>=e||0>=h?!1:t+e>this.width||i+h>this.height?!1:!0},h.prototype.placeCheck=function(t,i,e,h){if(!this.valuesCheck(t,i,e,h))return!1;var o,s;for(o=0;e>o;o++)for(s=0;h>s;s++)if(this.table[t+o][i+s]===!0)return!1;return!0},h.prototype.putItem=function(t,i,e,h,o,s){if(s===!0){if(!this.placeCheck(i,e,h,o))return!1}else if(!this.valuesCheck(i,e,h,o))return!1;void 0===h&&(h=t.widthUnit),void 0===o&&(o=t.heightUnit);var n,r,a;for(n=0;h>n;n++)for(r=0;o>r;r++)this.table[i+n][e+r]=!0;return a=h*o,this.freeSpace-=a,this.result.push({item:t,posX:i*this.unit,posY:e*this.unit,width:h*this.unit,height:o*this.unit}),t.incUsemeter(),!0},h.prototype.putToRandomPlace=function(t,i){for(var e,h=!1;!h&&i>0;)i--,e=this.getRandomPlace(t.widthUnit,t.heightUnit),h=this.placeCheck(e.x,e.y,t.widthUnit,t.heightUnit);return h?(this.putItem(t,e.x,e.y),e):!1},h.prototype.forceRandomPlace=function(t){var i=this.findPlace(t.widthUnit,t.heightUnit);if(i===!1)return!1;var e=Math.ceil(Math.random()*i.length)%i.length;return this.putItem(t,i[e].x,i[e].y),i[e]},h.prototype.findPlace=function(t,i,e){var h,o,s=[];for(e=void 0===e||1>e?this.size:e,h=0;h+t<=this.width;h++)for(o=0;o+i<=this.height;o++)if(this.placeCheck(h,o,t,i)&&(s.push({x:h,y:o}),s.length==e))return s;return 0===s.length?!1:s},h.prototype.getRandomPlace=function(t,i){return{x:Math.ceil(Math.random()*(this.width-t)),y:Math.ceil(Math.random()*(this.height-i))}},h.prototype.rendering=function(t){var i,e,h=document.createElement("div");for(var o in this.result)i=this.result[o],e={place:{posX:i.posX,posY:i.posY,width:i.width,height:i.height},item:{width:i.item.widthPx,height:i.item.heightPx},data:i.item.attached},e.item.posX=Math.ceil(Math.random()*(e.item.width-e.place.width)),e.item.posY=Math.ceil(Math.random()*(e.item.height-e.place.height)),h.appendChild(t(e));return h},h.prototype.displayMap=function(){var t,i,e;for(i=0;i<this.height;i++){for(e="",t=0;t<this.width;t++)e+=this.table[t][i]?"#":".";console.log(e)}},o.prototype.addItem=function(t,e,h){var o=new i(t,e,h);o!==!1&&this.album.addItem(o)},o.prototype.addStack=function(t){if(void 0===t||void 0===t.length||0===t.length)return!1;var i;for(var e in t)i=t[e],this.addItem(i[0],i[1],i[2])},o.prototype.setMotorLevel=function(t){return t>=0?(this.nbRandTentatives=t,!0):!1},o.prototype.setFinalFreeSpace=function(t){return t>=0&&100>=t?(this.marge=t,!0):!1},o.prototype.rendering=function(t){return t?this.map.rendering(t):void 0},o.prototype.generate=function(){this.album.sortIt(),this.album.resetUsemeter(),this.massMapFilling(),this.mapBlankSpaceFilling(),this.isGenerated=!0},o.prototype.massMapFilling=function(){var t,i,e;t=Math.ceil(this.map.size*((this.unit-this.marge)/this.unit)/this.album.size)-1;for(var h in this.album.portfolio)for(i=this.album.portfolio[h],e=!0;i.getUsemeter()<t&&e;)this.map.putToRandomPlace(i,t)===!1&&this.map.forceRandomPlace(i)===!1&&(e=!1)},o.prototype.mapBlankSpaceFilling=function(){var t,i,e,h,o,s,n;for(t=0,i=Math.ceil(this.map.size*(this.marge/this.unit));this.map.freeSpace>=i;){if(t<this.album.portfolio.length&&(s=this.album.portfolio[t].widthUnit,n=this.album.portfolio[t].heightUnit),e=this.map.findPlace(s,n,5),e!==!1){if(h=Math.ceil(Math.random()*e.length)%e.length,this.crop)for(o=this.album.getItemBiggerThan(s,n);o.widthUnit<s||o.heightUnit<n;)o=this.album.portfolio[Math.ceil(Math.random()*t)];else o=this.album.portfolio[t];this.map.putItem(o,e[h].x,e[h].y,s,n)}else if(t>this.album.portfolio.length&&(s>n?s--:n--,s*n===0))return;if(t++,!this.crop&&t==this.album.portfolio.length)return}},t.Wallery=o}(window);